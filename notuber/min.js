var map,marker,user_lat=0,user_lon=0,image="car.png";function init(){var e={zoom:12,center:new google.maps.LatLng(user_lat,user_lon),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map"),e),getMyLocation()}function getMyLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){user_lat=e.coords.latitude,user_lon=e.coords.longitude,createMap(),displayCars()}):alert("Geolocation isn't supported by your web browser. What a shame!")}function createMap(){me=new google.maps.LatLng(user_lat,user_lon),map.panTo(me),(marker=new google.maps.Marker({position:me,title:"Here I Am!"})).setMap(map);var e=new google.maps.InfoWindow;google.maps.event.addListener(marker,"click",function(){e.setContent(marker.title),e.open(map,marker)})}function displayCars(){xhr=new XMLHttpRequest,xhr.open("POST","https://dry-meadow-11596.herokuapp.com/rides",!0),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");var e="username=DaPLuvLU&lat="+String(user_lat)+"&lng="+String(user_lon);xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){for(jsonData=JSON.parse(xhr.responseText),count=0;count<jsonData.length;count++){new google.maps.Marker({position:{lat:jsonData[count].lat,lng:jsonData[count].lng},map:map,icon:image});marker.setMap(map)}nearestCar()}},xhr.send(e)}function nearestCar(){var e=new google.maps.LatLng(jsonData[0].lat,jsonData[0].lng),a=google.maps.geometry.spherical.computeDistanceBetween(me,e);for(count=0;count<jsonData.length;count++){var t=new google.maps.LatLng(jsonData[count].lat,jsonData[count].lng),o=google.maps.geometry.spherical.computeDistanceBetween(me,t);o<a&&(a=o)}}